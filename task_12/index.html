<!DOCTYPE html>
<html lang="">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Задание 12. Калькулятор</title>
  <meta name="description" content="" />
  <!-- Yandex.Metrika counter -->
<meta name="yandex-verification" content="721d8d42ba7b40bb" />

<script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();
    for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
    k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
 
    ym(91297238, "init", {
         clickmap:true,
         trackLinks:true,
         accurateTrackBounce:true
    });
 </script>
 <noscript><div><img src="https://mc.yandex.ru/watch/91297238" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
 <!-- /Yandex.Metrika counter -->

  <link rel="stylesheet" href="/styles/index.css">
  <link rel="stylesheet" href="/styles/katex.min.css">
</head>

<body>
  <nav>
    <ul>
      <li><a class="internal-link" href="/"><b>Алгоритмизация и программирование</b></a></li>
    </ul>
  </nav>

  <div class="wrapper">
    <main>
<content>
  <p><img src="/assets/bober.png" alt="бобёр"></p>
<h1>Калькулятор</h1>
<p>Мы с вами будем делать КАЛЬКУЛЯТОР! В том числе парсер выражения.</p>
<h2>Обратная польская запись</h2>
<p>На <a href="https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D1%80%D0%B0%D1%82%D0%BD%D0%B0%D1%8F_%D0%BF%D0%BE%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D1%8C">вики</a> описано хорошо.</p>
<p>Ваша программа должна уметь вычислять выражения в обратной польской записи и поддерживать:</p>
<ul>
<li>бинарные операции + - * /</li>
<li>целые числа, в том числе отрицательные.</li>
</ul>
<p>Пример использования:</p>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-type">int</span> res = <span class="hljs-built_in">calc</span>(<span class="hljs-string">"4 1 + 5 *"</span>);
  <span class="hljs-built_in">assert</span>(res == (<span class="hljs-number">4</span><span class="hljs-number">+1</span>)*<span class="hljs-number">5</span>);
}
</code></pre>
<h2>Программируемый польский калькулятор</h2>
<p>Усложним программу: добавим поддержку создания своих операторов произвольной арности, добавим поддержку float типов.</p>
<p>Проектируйте калькулятор, как библиотеку, чтобы пользователь мог дописать свой оператор и встроить в наш калькулятор, не меняя код самой библиотеки.</p>
<p>Главные нововведения:</p>
<ul>
<li>парсинг float чисел</li>
<li>создание операций произвольной арности, например, <code>sum</code> должна просуммировать вообще всё что в стеке лежит.</li>
</ul>
<p>Нельзя использовать std::atoi-like функций. Сами встройте парсер числа.</p>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  ModuleOp mod_op;
  Calculator calc;
  calc.<span class="hljs-built_in">register</span>(<span class="hljs-string">"%"</span>, &#x26;mod_op);
  SumOp sum_op;
  calc.<span class="hljs-built_in">register</span>(<span class="hljs-string">"sum"</span>, &#x26;sum_op);

  {
  <span class="hljs-keyword">auto</span> s = <span class="hljs-string">"6 8 + 3 %"</span>;
  <span class="hljs-keyword">auto</span> tokens = <span class="hljs-built_in">Tokenize</span>(s);
  <span class="hljs-type">float</span> res = calc.<span class="hljs-built_in">eval</span>(tokens);
  <span class="hljs-built_in">assert</span>(res == (<span class="hljs-number">6</span><span class="hljs-number">+8</span>) % <span class="hljs-number">3</span>);
  }

  {
    <span class="hljs-keyword">auto</span> tokens = <span class="hljs-built_in">Tokenize</span>(<span class="hljs-string">"1 2 3 4 5 6 sum"</span>);
    <span class="hljs-type">float</span> res = calc.<span class="hljs-built_in">eval</span>(tokens);
    <span class="hljs-built_in">assert</span>(res == <span class="hljs-number">1</span> + <span class="hljs-number">2</span> + <span class="hljs-number">3</span> + <span class="hljs-number">4</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span>);
  }
}
</code></pre>
<h2>Нормальный калькулятор</h2>
<p>Сделайте так, чтобы ваша библиотека поддерживала парсинг записей в инфиксной нотации: примение <a href="https://en.wikipedia.org/wiki/Shunting_yard_algorithm">алгоритм сортировочной станции</a>.</p>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  ModuleOp mod_op;
  Calculator calc;
  calc.<span class="hljs-built_in">register</span>(<span class="hljs-string">"%"</span>, &#x26;mod_op);
  SumOp sum_op;
  calc.<span class="hljs-built_in">register</span>(<span class="hljs-string">"sum"</span>, &#x26;sum_op);

  string s = <span class="hljs-string">"(1 + 4) / 5 + 9 % 2"</span>;
  <span class="hljs-keyword">auto</span> infix_tokens = <span class="hljs-built_in">Tokenize</span>(s);

  <span class="hljs-keyword">auto</span> polish_tokens = <span class="hljs-built_in">ShuntingYard</span>(infix_tokens);

  <span class="hljs-type">float</span> res = calc.<span class="hljs-built_in">eval</span>(polish_tokens);
}
</code></pre>
<h1>Подсказки</h1>
<p>Применяйте ООП.</p>
<p>Можете посмотреть мой <a href="https://youtu.be/3aMpifryO1A?si=mSIt0RVEoyP0sH2A">старый стрим на твитче</a> про Польский калькулятор.</p>
</content></main>
  </div>
</body>

</html>